<div class="register-container">
  <div class="register-card">
    <div class="register-header">
      <i class="fas fa-user-plus"></i>
      <h2>Create Account</h2>
      <p>Join StoreCare today and start shopping!</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      <!-- User Code -->
      <div class="form-group">
        <label for="userCode">
          <i class="fas fa-id-card"></i>
          User Code <span class="required">*</span>
        </label>
        <input type="text"
               id="userCode"
               formControlName="userCode"
               class="form-control"
               [class.error]="isFieldInvalid('userCode')"
               placeholder="Enter user code"
               maxlength="50">
        <div class="error-message" *ngIf="isFieldInvalid('userCode')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('userCode')?.errors?.['required']">User code is required</span>
          <span *ngIf="registerForm.get('userCode')?.errors?.['minlength']">User code must be at least 3 characters</span>
        </div>
      </div>

      <!-- Full Name -->
      <div class="form-group">
        <label for="fullName">
          <i class="fas fa-user"></i>
          Full Name <span class="required">*</span>
        </label>
        <input type="text"
               id="fullName"
               formControlName="fullName"
               class="form-control"
               [class.error]="isFieldInvalid('fullName')"
               placeholder="Enter your full name"
               maxlength="100">
        <div class="error-message" *ngIf="isFieldInvalid('fullName')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('fullName')?.errors?.['required']">Full name is required</span>
          <span *ngIf="registerForm.get('fullName')?.errors?.['minlength']">Full name must be at least 3 characters</span>
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email">
          <i class="fas fa-envelope"></i>
          Email Address <span class="required">*</span>
        </label>
        <input type="email"
               id="email"
               formControlName="email"
               class="form-control"
               [class.error]="isFieldInvalid('email')"
               placeholder="Enter your email">
        <div class="error-message" *ngIf="isFieldInvalid('email')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="registerForm.get('email')?.errors?.['email']">Enter a valid email address</span>
        </div>
      </div>

      <!-- Phone -->
      <div class="form-group">
        <label for="phone">
          <i class="fas fa-phone"></i>
          Phone Number
        </label>
        <input type="tel"
               id="phone"
               formControlName="phone"
               class="form-control"
               [class.error]="isFieldInvalid('phone')"
               placeholder="Enter your phone number">
        <div class="error-message" *ngIf="isFieldInvalid('phone')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('phone')?.errors?.['pattern']">Enter a valid phone number</span>
        </div>
      </div>

      <!-- Role ID (Hidden by default, can be shown if needed) -->
      <div class="form-group" *ngIf="showRoleField">
        <label for="roleId">
          <i class="fas fa-user-tag"></i>
          Role
        </label>
        <select id="roleId" formControlName="roleId" class="form-control">
          <option value="1">Customer</option>
          <option value="2">Store Owner</option>
          <option value="3">Admin</option>
        </select>
      </div>

      <!-- Store ID (Optional) -->
      <div class="form-group" *ngIf="showStoreField">
        <label for="storeId">
          <i class="fas fa-store"></i>
          Store ID
        </label>
        <input type="text"
               id="storeId"
               formControlName="storeId"
               class="form-control"
               placeholder="Enter store ID (optional)">
      </div>

      <!-- Password -->
      <div class="form-group">
        <label for="password">
          <i class="fas fa-lock"></i>
          Password <span class="required">*</span>
        </label>
        <div class="password-input-wrapper">
          <input [type]="showPassword ? 'text' : 'password'"
                 id="password"
                 formControlName="password"
                 class="form-control"
                 [class.error]="isFieldInvalid('password')"
                 placeholder="Enter your password">
          <button type="button"
                  class="password-toggle"
                  (click)="togglePasswordVisibility('password')">
            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="isFieldInvalid('password')">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('password')?.errors?.['required']">Password is required</span>
          <span *ngIf="registerForm.get('password')?.errors?.['minlength']">Password must be at least 8 characters</span>
          <span *ngIf="registerForm.get('password')?.errors?.['pattern']">Password must contain at least one uppercase, one lowercase, one number and one special character</span>
        </div>
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <label for="confirmPassword">
          <i class="fas fa-lock"></i>
          Confirm Password <span class="required">*</span>
        </label>
        <div class="password-input-wrapper">
          <input [type]="showConfirmPassword ? 'text' : 'password'"
                 id="confirmPassword"
                 formControlName="confirmPassword"
                 class="form-control"
                 [class.error]="isFieldInvalid('confirmPassword') || registerForm.errors?.['mismatch']"
                 placeholder="Confirm your password">
          <button type="button"
                  class="password-toggle"
                  (click)="togglePasswordVisibility('confirm')">
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div class="error-message" *ngIf="isFieldInvalid('confirmPassword') || registerForm.errors?.['mismatch']">
          <i class="fas fa-exclamation-circle"></i>
          <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</span>
          <span *ngIf="registerForm.errors?.['mismatch']">Passwords do not match</span>
        </div>
      </div>

      <!-- Password Strength Indicator -->
      <div class="password-strength" *ngIf="registerForm.get('password')?.value">
        <div class="strength-bar">
          <div class="strength-progress" [style.width]="getPasswordStrength() + '%'" [class]="getPasswordStrengthClass()"></div>
        </div>
        <span class="strength-text" [class]="getPasswordStrengthClass()">
          {{ getPasswordStrengthText() }}
        </span>
      </div>

      <!-- Profile Picture (Optional) -->
      <div class="form-group">
        <label for="profilePicture">
          <i class="fas fa-camera"></i>
          Profile Picture
        </label>
        <div class="file-input-wrapper">
          <input type="file"
                 id="profilePicture"
                 (change)="onFileSelected($event)"
                 accept="image/*"
                 class="file-input">
          <button type="button" class="file-input-button" (click)="triggerFileInput()">
            <i class="fas fa-upload"></i>
            Choose File
          </button>
          <span class="file-name">{{ selectedFileName || 'No file chosen' }}</span>
        </div>
        <div class="image-preview" *ngIf="imagePreview">
          <img [src]="imagePreview" alt="Profile preview">
          <button type="button" class="remove-image" (click)="removeImage()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div class="form-group terms-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="acceptTerms">
          <span class="checkbox-text">
            I accept the <a href="#" target="_blank">Terms and Conditions</a> and
            <a href="#" target="_blank">Privacy Policy</a> <span class="required">*</span>
          </span>
        </label>
        <div class="error-message" *ngIf="isFieldInvalid('acceptTerms')">
          <i class="fas fa-exclamation-circle"></i>
          <span>You must accept the terms and conditions</span>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button type="submit"
                class="btn-submit"
                [disabled]="registerForm.invalid || isSubmitting">
          <i class="fas" [class.fa-spinner]="isSubmitting" [class.fa-spin]="isSubmitting" [class.fa-user-plus]="!isSubmitting"></i>
          <span>{{ isSubmitting ? 'Creating Account...' : 'Create Account' }}</span>
        </button>
      </div>

      <!-- Login Link -->
      <div class="login-link">
        Already have an account? <a routerLink="/login">Sign In</a>
      </div>
    </form>

    <!-- Success Message -->
    <div class="success-message" *ngIf="showSuccess">
      <i class="fas fa-check-circle"></i>
      <h3>Registration Successful!</h3>
      <p>Your account has been created successfully. Please check your email to verify your account.</p>
      <button class="btn-login" routerLink="/login">Go to Login</button>
    </div>
  </div>
</div>
